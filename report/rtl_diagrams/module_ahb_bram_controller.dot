digraph ahb_bram_controller {
    rankdir=LR;
    bgcolor="white";
    node [fontname="Arial", fontsize=11];
    edge [fontname="Arial", fontsize=9];
    
    // Title
    label="BRAM Controller Module\nAHB to BRAM Protocol Conversion";
    labelloc="t";
    fontname="Arial Bold";
    fontsize=14;
    
    // Input signals
    subgraph cluster_inputs {
        label="AHB Interface Inputs";
        labelloc="t";
        style="filled";
        fillcolor="#f0f8ff";
        color="#4169e1";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#e6f3ff", 
              color="#4682b4", penwidth=2, fontsize=10];
        
        CLK [label="HCLK"];
        RES [label="HRESETn"];
        HSEL [label="HSELx\nChip Select"];
        HADDR [label="HADDR\nAddress"];
        HWRITE [label="HWRITE\nWrite Enable"];
        HSIZE [label="HSIZE\nTransfer Size"];
        HTRANS [label="HTRANS\nTransfer Type"];
        HREADY [label="HREADY\nReady Input"];
        HWDATA [label="HWDATA\nWrite Data"];
    }
    
    // BRAM input
    subgraph cluster_bram_in {
        label="BRAM Data Input";
        labelloc="t";
        style="filled";
        fillcolor="#fff0f0";
        color="#dc143c";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#ffe6e6", 
              color="#dc143c", penwidth=2];
        
        BRAM_DOUT [label="bram_douta\nBRAM Read Data"];
    }
    
    // Main module
    subgraph cluster_module {
        label="";
        style="rounded,filled";
        fillcolor="#fffaf0";
        color="#ff8c00";
        penwidth=3;
        
        node [shape=box, style="rounded,filled"];
        
        // Protocol converter
        PROTO [label="AHB Protocol Control\n• State Machine\n• Address Latch\n• Data Latch", 
              fillcolor="#ffd700", color="#ff8c00", penwidth=2, fontsize=11];
        
        // Address translator
        ADDR [label="Address Translation\n• Byte Offset\n• Alignment Handling", 
             fillcolor="#ffe4b5", color="#ff8c00", penwidth=2, fontsize=10];
        
        // Write control
        WRITE [label="Write Control Logic\n• Byte Write Enable\n• Data Alignment\n• Size Decode", 
              fillcolor="#ffb6c1", color="#ff1493", penwidth=2, fontsize=10];
        
        // Read control
        READ [label="Read Control Logic\n• Data Alignment\n• Size Extension\n• 1-Cycle Delay", 
             fillcolor="#afeeee", color="#20b2aa", penwidth=2, fontsize=10];
        
        // Response generator
        RESP [label="Response Generation\n• HRESP\n• HREADYOUT", 
             fillcolor="#98fb98", color="#228b22", penwidth=2, fontsize=10];
    }
    
    // Output signals - AHB
    subgraph cluster_outputs_ahb {
        label="AHB Interface Outputs";
        labelloc="t";
        style="filled";
        fillcolor="#f0fff0";
        color="#228b22";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#e6ffe6", 
              color="#2e8b57", penwidth=2, fontsize=10];
        
        HRDATA [label="HRDATA\nRead Data"];
        HRESP [label="HRESP\nResponse"];
        HREADYOUT [label="HREADYOUT\nReady Output"];
    }
    
    // Output signals - BRAM
    subgraph cluster_outputs_bram {
        label="BRAM Interface Outputs";
        labelloc="t";
        style="filled";
        fillcolor="#fff0ff";
        color="#9370db";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#f3e6ff", 
              color="#8b008b", penwidth=2, fontsize=10];
        
        BRAM_ADDR [label="bram_addra\nAddress"];
        BRAM_DIN [label="bram_dina\nWrite Data"];
        BRAM_EN [label="bram_ena\nEnable"];
        BRAM_WE [label="bram_wea[3:0]\nByte Write Enable"];
    }
    
    // Input connections
    CLK -> PROTO [label="Clock", color="#4169e1", penwidth=1.5];
    RES -> PROTO [label="Reset", color="#ff0000", penwidth=1.5];
    HSEL -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    HTRANS -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    HREADY -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    
    HADDR -> ADDR [label="Address", color="#ff8c00", penwidth=2];
    HSIZE -> ADDR [color="#ff8c00", penwidth=1.5, style="dashed"];
    
    HWRITE -> WRITE [color="#ff1493", penwidth=1.5];
    HSIZE -> WRITE [color="#ff1493", penwidth=1.5, style="dashed"];
    HWDATA -> WRITE [label="Write Data", color="#ff1493", penwidth=2];
    
    HSIZE -> READ [color="#20b2aa", penwidth=1.5, style="dashed"];
    BRAM_DOUT -> READ [label="BRAM Data", color="#dc143c", penwidth=2];
    
    // Internal connections
    PROTO -> ADDR [label="Control", color="#ff8c00", penwidth=1.5];
    PROTO -> WRITE [label="Control", color="#ff8c00", penwidth=1.5, style="dashed"];
    PROTO -> READ [label="Control", color="#ff8c00", penwidth=1.5, style="dashed"];
    PROTO -> RESP [label="State", color="#ff8c00", penwidth=1.5];
    
    ADDR -> WRITE [label="Offset", color="#ff8c00", penwidth=1.5, style="dashed"];
    ADDR -> READ [label="Offset", color="#ff8c00", penwidth=1.5, style="dashed"];
    
    // Output connections - AHB
    READ -> HRDATA [label="Aligned Data", color="#228b22", penwidth=2];
    RESP -> HRESP [color="#228b22", penwidth=1.5];
    RESP -> HREADYOUT [color="#228b22", penwidth=1.5];
    
    // Output connections - BRAM
    ADDR -> BRAM_ADDR [label="Translated", color="#9370db", penwidth=2];
    WRITE -> BRAM_DIN [label="Aligned", color="#9370db", penwidth=2];
    PROTO -> BRAM_EN [color="#9370db", penwidth=1.5];
    WRITE -> BRAM_WE [label="Byte Enable", color="#9370db", penwidth=2];
}
