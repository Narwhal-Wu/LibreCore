digraph ahb_irom_controller {
    rankdir=LR;
    bgcolor="white";
    node [fontname="Arial", fontsize=11];
    edge [fontname="Arial", fontsize=9];
    
    // Title
    label="IROM 控制器模块 (IROM Controller)\nAHB 到指令 ROM 协议转换";
    labelloc="t";
    fontname="Arial Bold";
    fontsize=14;
    
    // Input signals
    subgraph cluster_inputs {
        label="AHB 接口输入";
        labelloc="t";
        style="filled";
        fillcolor="#f0f8ff";
        color="#4169e1";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#e6f3ff", 
              color="#4682b4", penwidth=2, fontsize=10];
        
        CLK [label="HCLK"];
        RES [label="HRESETn"];
        HSEL [label="HSELx\n片选"];
        HADDR [label="HADDR\n地址"];
        HWRITE [label="HWRITE\n写使能"];
        HSIZE [label="HSIZE\n传输大小"];
        HTRANS [label="HTRANS\n传输类型"];
        HREADY [label="HREADY\n就绪输入"];
    }
    
    // ROM input
    subgraph cluster_rom_in {
        label="ROM 数据输入";
        labelloc="t";
        style="filled";
        fillcolor="#fff0f0";
        color="#dc143c";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#ffe6e6", 
              color="#dc143c", penwidth=2];
        
        ROM_DOUT [label="bram_douta\nROM读数据"];
    }
    
    // Main module
    subgraph cluster_module {
        label="";
        style="rounded,filled";
        fillcolor="#f0f0ff";
        color="#6a5acd";
        penwidth=3;
        
        node [shape=box, style="rounded,filled"];
        
        // Protocol converter
        PROTO [label="AHB 协议控制\n• 状态机\n• 地址锁存\n• 只读控制", 
              fillcolor="#dda0dd", color="#9370db", penwidth=2, fontsize=11];
        
        // Address translator
        ADDR [label="地址转换\n• 字节偏移\n• 对齐检查", 
             fillcolor="#e6e6fa", color="#6a5acd", penwidth=2, fontsize=10];
        
        // Read control
        READ [label="读控制逻辑\n• 数据对齐\n• 大小扩展\n• 连续读取", 
             fillcolor="#b0c4de", color="#4682b4", penwidth=2, fontsize=10];
        
        // Write check
        WRITE_CHK [label="写保护检查\n• 写操作检测\n• 返回错误", 
                  fillcolor="#ffb6c1", color="#ff1493", penwidth=2, fontsize=10];
        
        // Response generator
        RESP [label="响应生成\n• HRESP\n• HREADYOUT", 
             fillcolor="#98fb98", color="#228b22", penwidth=2, fontsize=10];
    }
    
    // Output signals - AHB
    subgraph cluster_outputs_ahb {
        label="AHB 接口输出";
        labelloc="t";
        style="filled";
        fillcolor="#f0fff0";
        color="#228b22";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#e6ffe6", 
              color="#2e8b57", penwidth=2, fontsize=10];
        
        HRDATA [label="HRDATA\n读数据"];
        HRESP [label="HRESP\n响应"];
        HREADYOUT [label="HREADYOUT\n就绪输出"];
    }
    
    // Output signals - ROM
    subgraph cluster_outputs_rom {
        label="ROM 接口输出";
        labelloc="t";
        style="filled";
        fillcolor="#fff0ff";
        color="#9370db";
        penwidth=2;
        
        node [shape=ellipse, style="filled", fillcolor="#f3e6ff", 
              color="#8b008b", penwidth=2, fontsize=10];
        
        ROM_ADDR [label="bram_addra\n地址"];
        ROM_EN [label="bram_ena\n使能"];
    }
    
    // Input connections
    CLK -> PROTO [label="时钟", color="#4169e1", penwidth=1.5];
    RES -> PROTO [label="复位", color="#ff0000", penwidth=1.5];
    HSEL -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    HTRANS -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    HREADY -> PROTO [color="#4169e1", penwidth=1.5, style="dashed"];
    
    HADDR -> ADDR [label="地址", color="#6a5acd", penwidth=2];
    HSIZE -> ADDR [color="#6a5acd", penwidth=1.5, style="dashed"];
    
    HWRITE -> WRITE_CHK [label="写检测", color="#ff1493", penwidth=2];
    
    HSIZE -> READ [color="#4682b4", penwidth=1.5, style="dashed"];
    ROM_DOUT -> READ [label="ROM数据", color="#dc143c", penwidth=2];
    
    // Internal connections
    PROTO -> ADDR [label="控制", color="#6a5acd", penwidth=1.5];
    PROTO -> READ [label="控制", color="#6a5acd", penwidth=1.5, style="dashed"];
    PROTO -> RESP [label="状态", color="#6a5acd", penwidth=1.5];
    
    ADDR -> READ [label="偏移", color="#6a5acd", penwidth=1.5, style="dashed"];
    
    WRITE_CHK -> RESP [label="错误", color="#ff1493", penwidth=2, style="dashed"];
    
    // Output connections - AHB
    READ -> HRDATA [label="对齐数据", color="#228b22", penwidth=2];
    RESP -> HRESP [color="#228b22", penwidth=1.5];
    RESP -> HREADYOUT [color="#228b22", penwidth=1.5];
    
    // Output connections - ROM
    ADDR -> ROM_ADDR [label="转换后", color="#9370db", penwidth=2];
    PROTO -> ROM_EN [color="#9370db", penwidth=1.5];
}
